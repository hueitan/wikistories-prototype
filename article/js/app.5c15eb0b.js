(function(e){function t(t){for(var s,n,c=t[0],o=t[1],l=t[2],m=0,d=[];m<c.length;m++)n=c[m],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&d.push(a[n][0]),a[n]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],s=!0,c=1;c<r.length;c++){var o=r[c];0!==a[o]&&(s=!1)}s&&(i.splice(t--,1),e=n(n.s=r[0]))}return e}var s={},a={app:0},i=[];function n(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=s,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=o;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";r("85ec")},"04a9":function(e,t,r){},2118:function(e,t,r){"use strict";r("8b2b")},"217f":function(e,t,r){"use strict";r("703d")},2480:function(e,t,r){"use strict";r("ef9e")},"2c35":function(e,t,r){"use strict";r("e689")},3698:function(e,t,r){},4935:function(e,t,r){"use strict";r("04a9")},"56d7":function(e,t,r){"use strict";r.r(t);var s=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("meta",{attrs:{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"}}),r("router-view")],1)},i=[],n={name:"App"},c=n,o=(r("034f"),r("2877")),l=Object(o["a"])(c,a,i,!1,null,null,null),u=l.exports,m=r("8c4f"),d=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view home"},[r("div",{staticClass:"center"},[r("b",[e._v(e._s(e.$i18n("welcome")))]),r("router-link",{staticClass:"create-story",attrs:{to:"/story"}},[e._v(e._s(e.$i18n("btn-create")))])],1)])},p=[],f={name:"Home"},h=f,g=(r("cccb"),Object(o["a"])(h,d,p,!1,null,null,null)),b=g.exports,v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view story"},[r("CurrentFrame"),r("Frames"),r("SearchToolbar")],1)},y=[],_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"current-frame",style:e.currentFrame.style},[e.currentFrame.text?r("p",[e._v(e._s(e.currentFrame.text))]):e._e()])},w=[],k=r("2f62"),S={name:"CurrentFrame",computed:Object(k["c"])(["currentFrame"])},x=S,C=(r("2c35"),Object(o["a"])(x,_,w,!1,null,null,null)),T=C.exports,I=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"frames"},[e._l(e.thumbnails,(function(t){return r("div",{key:t.id,staticClass:"frame",class:{"selected-frame":t.selected},style:t.style,on:{click:function(r){return e.selectFrame(t.id)}}})})),r("div",{staticClass:"frame btn-add-frame",on:{click:e.addFrame}},[e._v("+")])],2)},j=[],O={name:"Frames",computed:Object(k["c"])(["thumbnails"]),methods:Object(k["b"])(["selectFrame","addFrame"])},F=O,A=(r("2480"),Object(o["a"])(F,I,j,!1,null,null,null)),$=A.exports,q=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"search-toolbar"},[r("router-link",{staticClass:"commons logo",attrs:{to:"/searchcommons"}},[e._v(e._s(e.$i18n("wikimedia-commons")))]),r("router-link",{staticClass:"wikipedia logo",attrs:{to:"/searchwikipedia"}},[e._v(e._s(e.$i18n("wikipedia")))])],1)},E=[],L={name:"SearchToolbar"},P=L,R=(r("2118"),Object(o["a"])(P,q,E,!1,null,"940a5c32",null)),W=R.exports,M={name:"Story",components:{CurrentFrame:T,Frames:$,SearchToolbar:W}},B=M,H=(r("217f"),Object(o["a"])(B,v,y,!1,null,null,null)),D=H.exports,V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view search-wp"},[r("form",[r("router-link",{attrs:{to:"Story"}},[r("div",{staticClass:"back"})]),r("div",{staticClass:"label"},[e._v(e._s(e.$i18n("search-box")))]),r("input",{staticClass:"query",attrs:{type:"text",placeholder:[[e.$i18n("search-box")]]},domProps:{value:e.query},on:{input:e.onInput}}),r("div",{staticClass:"icon"}),e.query?r("div",{staticClass:"close",on:{click:e.onClear}}):e._e()],1),e.loading?r("div",{staticClass:"loading-bar"}):e._e(),r("ListView",{attrs:{items:e.searchResults}})],1)},U=[],J=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"listview"},e._l(e.items,(function(t){return r("div",{key:t.title,staticClass:"item"},[r("router-link",{attrs:{to:t.goto}},[r("div",{staticClass:"img",style:{backgroundImage:"url("+t.thumb+")"}}),r("div",{staticClass:"info"},[r("div",{staticClass:"title"},[e._v(e._s(t.title))]),r("div",{staticClass:"description"},[e._v(e._s(t.desc))])])])],1)})),0)},Q=[],z={name:"ListView",props:["items"]},N=z,G=(r("f5ca"),Object(o["a"])(N,J,Q,!1,null,null,null)),X=G.exports,K={name:"SearchWikipedia",components:{ListView:X},methods:{...Object(k["b"])(["search","clear"]),onInput:function(e){e.preventDefault(),this.search(e.target.value)},onClear:function(e){e.preventDefault(),this.clear()}},computed:Object(k["c"])(["loading","searchResults","query"])},Y=K,Z=(r("884e"),Object(o["a"])(Y,V,U,!1,null,null,null)),ee=Z.exports,te=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view"},[r("Back"),r("div",{staticClass:"article",domProps:{innerHTML:e._s(e.currentArticle)},on:{mouseup:e.onAfterSelect,touchend:e.onAfterSelect}}),r("div",{staticClass:"toolbar",style:e.selectionToolbarStyle},[r("div",{on:{click:e.onUseText}},[e._v("Highlight")]),r("div",{on:{click:e.onDismiss}},[e._v("Clear")])]),e.showImages?r("div",{staticClass:"article-overlay"}):e._e(),e.showImages?r("ArticleImages",{staticClass:"images",attrs:{images:e.articleImages,onSubmit:e.onUseImage}}):e._e()],1)},re=[],se=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"back",on:{click:function(t){return e.$router.go(-1)}}})},ae=[],ie={name:"Back"},ne=ie,ce=(r("b37b"),Object(o["a"])(ne,se,ae,!1,null,null,null)),oe=ce.exports,le=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"article-images"},[r("div",{staticClass:"article-images-header"},[r("span",[e._v("Select an image")]),e.selectedImage?r("a",{on:{click:function(t){return e.onSubmit(e.selectedImage)}}},[e._v("Next")]):e._e()]),r("div",{staticClass:"article-images-thumbs"},e._l(e.images,(function(t){return r("img",{key:t.src,staticClass:"article-image-thumb",class:{selected:e.selectedImage===t.src},attrs:{src:t.src},on:{click:function(r){return e.selectImage(t.src)}}})})),0)])},ue=[],me={name:"ArticleImages",props:["images","onSubmit"],data:()=>({selectedImage:null}),methods:{selectImage:function(e){this.selectedImage=e}}},de=me,pe=(r("c452"),Object(o["a"])(de,le,ue,!1,null,null,null)),fe=pe.exports,he={name:"Article",props:["article"],components:{Back:oe,ArticleImages:fe},data:()=>({selectionToolbarStyle:{display:"none",position:"absolute"},selectedText:null,showImages:!1,images:[]}),computed:{...Object(k["c"])(["currentArticle"]),articleImages:()=>Array.from(document.querySelector(".article").querySelectorAll("img")).map(e=>({src:e.src}))},methods:{...Object(k["b"])(["fetchArticle","setText","setImg"]),showSelectionToolbar:function(e){this.selectionToolbarStyle.display="flex",this.selectionToolbarStyle.top=e.top-43+"px",this.selectionToolbarStyle.left=e.left+"px"},hideSelectionToolbar:function(){this.selectionToolbarStyle.display="none"},onAfterSelect:function(e){e.preventDefault();const t=document.getSelection(),r=t&&t.getRangeAt(0);r&&!r.collapsed?(this.selectedText=t.toString(),this.showSelectionToolbar(r.getBoundingClientRect())):this.hideSelectionToolbar()},onUseText:function(){this.hideSelectionToolbar(),this.showImages=!0},onUseImage:function(e){this.setText(this.selectedText),this.setImg(e),this.$router.push({name:"Story"})},onDismiss:function(){this.hideSelectionToolbar()}},created:function(){this.fetchArticle(this.article)}},ge=he,be=(r("4935"),Object(o["a"])(ge,te,re,!1,null,null,null)),ve=be.exports;s["a"].use(m["a"]);const ye=[{path:"/",name:"Home",component:b},{path:"/story",name:"Story",component:D},{path:"/searchwikipedia",name:"SearchWikipedia",component:ee},{path:"/article/:article",name:"Article",component:ve,props:!0}],_e=new m["a"]({routes:ye});var we=_e;const ke=5,Se=e=>e.img?{backgroundImage:"url("+e.img+")",backgroundPosition:"center",backgroundSize:"cover"}:{background:"linear-gradient(0deg, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 35%, rgba(0,212,255,1) 100%)"};var xe={state:{currentFrameId:1,frames:[{id:1,img:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b9/Bandhavgarh_Tigers.jpg/640px-Bandhavgarh_Tigers.jpg",text:"Bandhavgarh Tigers"},{id:2,img:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/White_Tiger_in_Touroparc.jpg/640px-White_Tiger_in_Touroparc.jpg",text:"White Tiger in Touroparc"},{id:3,img:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/TigerVector.png/640px-TigerVector.png",text:"Taken from the Coat of arms of Vladivostok and modified."}]},mutations:{selectFrame:(e,t)=>e.currentFrameId=t,addFrame:e=>{if(e.frames.length===ke)return;const t=e.frames.length+1;e.frames.push({text:"",img:"",id:t}),e.currentFrameId=t},setText:(e,t)=>{const r=e.frames.find(t=>t.id===e.currentFrameId);r.text=t},setImg:(e,t)=>{const r=e.frames.find(t=>t.id===e.currentFrameId);r.img=t}},actions:{selectFrame:({commit:e},t)=>{e("selectFrame",t)},addFrame:({commit:e})=>{e("addFrame")},setText:({commit:e},t)=>{e("setText",t)},setImg:({commit:e},t)=>{e("setImg",t)}},getters:{thumbnails:e=>e.frames.map(t=>{const r={...t};return t.id===e.currentFrameId&&(r.selected=!0),r.style=Se(t),r}),currentFrame:e=>{const t=e.frames.find(t=>t.id===e.currentFrameId);return{text:t.text,style:Se(t),noImage:""===t.img}}}};let Ce=[];const Te=()=>{Ce.forEach(e=>e&&e.abort()),Ce=[]},Ie=(e,t)=>{Te();const r=new XMLHttpRequest;r.open("GET",e),r.send(),r.addEventListener("load",()=>{t(JSON.parse(r.responseText))}),r.addEventListener("error",()=>{t(null,r.status)}),Ce.push(r)};var je={state:{loading:!1,results:[],query:""},mutations:{setLoading:(e,t)=>e.loading=t,setQuery:(e,t)=>e.query=t,setSearchResults:(e,t)=>e.results=t},actions:{search:({commit:e},t)=>{const r=t.trim(),s=`https://en.wikipedia.org/w/rest.php/v1/search/title?q=${r}&limit=10`;if(e("setQuery",t),!r)return Te(),e("setLoading",!1),void e("setSearchResults",[]);e("setLoading",!0),Ie(s,t=>{t.pages&&e("setSearchResults",Object.values(t.pages).map(e=>({title:e.title,desc:e.description,thumb:e.thumbnail&&e.thumbnail.url,goto:{name:"Article",params:{article:e.title}}}))),e("setLoading",!1)})},clear:({commit:e})=>{Te(),e("setLoading",!1),e("setSearchResults",[]),e("setQuery","")}},getters:{loading:e=>e.loading,searchResults:e=>e.results,query:e=>e.query}};const Oe={"put styles in body":e=>{for(const t of e.head.querySelectorAll('link[rel="stylesheet"]'))e.body.prepend(t)},"remove stuff":e=>{const t=["table",".pcs-collapse-table-container","script"];for(const r of e.querySelectorAll(t.join(",")))r.remove()},"unhide sections":e=>{for(const t of e.querySelectorAll("section"))t.style.display="block"},"remove links":e=>{let t;for(const r of e.querySelectorAll("a"))t=e.createElement("span"),t.innerHTML=r.innerHTML,r.replaceWith(t)},"load images":e=>{for(const t of e.querySelectorAll("figure")){let r=t.querySelector("span[data-src]");if(r){let s=e.createElement("img");s.src=r.getAttribute("data-src"),s.classList.add("pcs-widen-image-override"),s.classList.add("pcs-lazy-load-image-loaded"),t.replaceChildren(s)}else t.remove()}}};var Fe={state:{article:{title:"",html:""}},mutations:{setArticle:({article:e},{title:t,html:r})=>{e.title=t,e.html=r}},actions:{fetchArticle:async({commit:e},t)=>{const r="https://en.wikipedia.org/api/rest_v1/page/mobile-html/"+t,s=await(await fetch(r)).text(),a=(new DOMParser).parseFromString(s,"text/html");Object.values(Oe).forEach(e=>e(a)),e("setArticle",{title:t,html:a.body.outerHTML})}},getters:{currentArticle:({article:e})=>e.html}};s["a"].use(k["a"]);var Ae=new k["a"].Store({modules:{story:xe,search:je,article:Fe}}),$e=r("5093"),qe=r.n($e),Ee={welcome:"Welcome to Wikistories","btn-create":"Create a story","wikimedia-commons":"Commons",wikipedia:"Wikipedia","search-box":"Search Wikipedia"},Le={welcome:"Bienvenue sur les Wikistoires","btn-create":"Creer une histoire"};const Pe=()=>new URL(location.href).searchParams.get("lang")||"en";s["a"].use(qe.a,{locale:Pe(),messages:{en:Ee,fr:Le}}),s["a"].config.productionTip=!1,new s["a"]({router:we,store:Ae,render:e=>e(u)}).$mount("#app")},"58e4":function(e,t,r){},"5ced":function(e,t,r){},"703d":function(e,t,r){},"85ec":function(e,t,r){},"884e":function(e,t,r){"use strict";r("ba7b")},"8b2b":function(e,t,r){},a8b7:function(e,t,r){},b37b:function(e,t,r){"use strict";r("3698")},ba7b:function(e,t,r){},c452:function(e,t,r){"use strict";r("a8b7")},cccb:function(e,t,r){"use strict";r("5ced")},e689:function(e,t,r){},ef9e:function(e,t,r){},f5ca:function(e,t,r){"use strict";r("58e4")}});
//# sourceMappingURL=app.5c15eb0b.js.map